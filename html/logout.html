<!DOCTYPE html>
<html lang="en">

<head>
  <title>Tartarus - Logout</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1">
  <meta name="description" content="Tartarus is a game developer and publisher">
  <meta name="keywords" content="cyber-amr, tartarus, spirit, games, studio">
  <meta property="og:image" content="https://amr-dev.info/studio.png">
  <link rel="icon" type="image/x-icon" href="icon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <script>let FIX_FF_FOUC;</script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MWHPXGX9FN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-MWHPXGX9FN');
  </script>
  <style>
    body {
      background-color: #1a1b26;
      color: #a9b3d6;
      font-family: 'Courier New', 'Lucida Console', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      line-height: 1.6;
      padding: 1rem;
    }

    .logout-container {
      background-color: #24283b;
      padding: 2rem;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 600px;
    }

    .prompt {
      color: #6faaf6;
      margin-bottom: 2rem;
      font-size: 1.2em;
    }

    .user-data {
      background-color: #1a1b26;
      padding: 1rem;
      border: 1px solid #393f69;
      margin-bottom: 1.5rem;
    }

    .data-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border-bottom: 1px solid #393f69;
    }

    .data-row:last-child {
      border-bottom: none;
    }

    .data-label {
      color: #6faaf6;
    }

    .data-value {
      color: #9ece6e;
    }

    .status {
      color: #f6666f;
      margin-bottom: 1rem;
    }

    .progress {
      height: 20px;
      background: #1a1b26;
      border: 1px solid #393f69;
      position: relative;
      margin: 1rem 0;
    }

    .progress-bar {
      height: 100%;
      background-color: #6faaf6;
      width: 0;
      animation: progress 5s ease-out forwards;
    }

    @keyframes progress {
      0% {
        width: 0;
      }

      20% {
        width: 0%;
      }

      100% {
        width: 100%;
      }
    }

    .spinner {
      display: inline-block;
      margin-left: 0.5rem;
    }

    .message {
      margin-top: 1rem;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="logout-container">
    <div class="prompt">$ ./logout --terminate-session</div>
    <div class="user-data">
      <div class="data-row">
        <span class="data-label">display_name:~$</span>
        <span class="data-value" id="displayName"></span>
      </div>
      <div class="data-row">
        <span class="data-label">username:~$</span>
        <span class="data-value" id="username"></span>
      </div>
      <div class="data-row">
        <span class="data-label">email:~$</span>
        <span class="data-value" id="email"></span>
      </div>
      <div class="data-row">
        <span class="data-label">last_active:~$</span>
        <span class="data-value" id="lastActive"></span>
      </div>
      <div class="data-row">
        <span class="data-label">session_duration:~$</span>
        <span class="data-value" id="sessionDuration"></span>
      </div>
    </div>
    <div class="status">
      [INFO] Terminating active session<span class="spinner">|</span>
    </div>
    <div class="progress">
      <div class="progress-bar"></div>
    </div>
    <div class="message">You will be redirected to the login page...</div>
  </div>

  <script>
    fetch('/private-api/user', { method: 'GET', headers: { 'Content-Type': 'application/json' } }).then(res => res.json()).then(user => {
      document.getElementById('username').textContent = user.username
      document.getElementById('email').textContent = user.email
      document.getElementById('displayName').textContent = user.displayName
    }).catch(e => alert(e))

    fetch('/private-api/session', { method: 'GET', headers: { 'Content-Type': 'application/json' } }).then(res => res.json()).then(session => {
      document.getElementById('lastActive').textContent = `${(new Date(session.lastActive)).toLocaleDateString('en', {
        weekday: "long",
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      })}`
      function updateDuration() {
        const t = Math.floor((Date.now() - (new Date(session.createDate)).getTime()) / 1000)
        const d = Math.floor(t / 86400)
        const h = Math.floor((t % 86400) / 3600)
        const m = Math.floor(((t % 86400) % 3600) / 60)
        document.getElementById('sessionDuration').textContent = `${d ? d + "d" : ""} ${h ? h + "h" : ""} ${m ? m + "m" : ""} ${t % 60}s`
      }
      updateDuration()
      setInterval(updateDuration, 1000)
    }).catch(e => alert(e))

    const spinnerChars = ['|', '/', 'â”€', '\\']
    let spinnerIndex = 0
    const spinner = document.querySelector('.spinner')
    setInterval(() => {
      spinner.textContent = spinnerChars[spinnerIndex]
      spinnerIndex = (spinnerIndex + 1) % spinnerChars.length
    }, 250)

    setTimeout(() => {
      fetch('/logout', { method: "POST", headers: { 'Content-Type': 'application/json' } })
      localStorage.clear()
      window.location.href = '/login'
    }, 5000)
  </script>
</body>

</html>
